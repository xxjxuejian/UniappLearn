{"version":3,"file":"classList.js","sources":["pages/classList/classList.vue","../../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvY2xhc3NMaXN0L2NsYXNzTGlzdC52dWU"],"sourcesContent":["<template>\r\n\t<!-- 刚进来，数据还在加载，显示加载中 -->\r\n\t<view class=\"loadMore\" v-if=\"!pageData.length && !isNodata\">\r\n\t\t<uni-load-more status=\"loading\"></uni-load-more>\r\n\t</view>\r\n\t\n\t<view class=\"classList\">\n\t\t<view class=\"content\">\r\n\t\t\t<navigator url=\"/pages/preview/preview\" class=\"item\" v-for=\"item in pageData\" :key=\"item._id\">\r\n\t\t\t\t<image :src=\"item.smallPicurl\" mode=\"aspectFill\"></image>\r\n\t\t\t</navigator>\r\n\t\t\t\r\n\t\t\t<navigator url=\"/pages/preview/preview\" class=\"item end\">\r\n\t\t\t</navigator>\r\n\t\t</view>\n\t</view>\r\n\r\n\t<view class=\"loadMore\" v-if=\"isNodata\">\r\n\t\t<uni-load-more status=\"noMore\"></uni-load-more>\r\n\t</view>\r\n\t\r\n\t<view class=\"loadMore\" v-if=\"isLoading && pageData.length !== 0\">\r\n\t\t<uni-load-more status=\"loading\"></uni-load-more>\r\n\t</view>\r\n\t\r\n</template>\n\n<script setup>\r\n\tconst prop = defineProps([\"id\",\"name\"])\r\n\timport {apiGetClassifyList} from \"@/api/apis.js\"\r\n\timport {onLoad,onReachBottom,onPullDownRefresh} from \"@dcloudio/uni-app\"\r\n\tonLoad((e)=>{\r\n\t\tconsole.log(\"生命周期\",e)\r\n\t\tconst {id=null,name=\"\"} = e\r\n\t\tif(id){\r\n\t\t\tqueryParams.classid = id\r\n\t\t}\r\n\t\tgetPageData(id)\r\n\t\t\r\n\t\tuni.setNavigationBarTitle({\r\n\t\t\ttitle:name\r\n\t\t})\r\n\t})\r\n\t\r\n\t// 判断是否 获取了全部数据\r\n\tlet isNodata = ref(false)\r\n\tconst isLoading = ref(false)\r\n\t// 查询参数\r\n\tconst queryParams = {\r\n\t\tclassid:undefined,\r\n\t\tpageNum:1,\r\n\t\tpageSize:12\r\n\t}\r\n\t\r\n\t// 获取页面数据\n\tconst pageData = ref([])\r\n \tasync function getPageData(){\r\n\t\t\r\n\t\tconst res = await apiGetClassifyList(queryParams)\r\n\t\tconsole.log(\"res\",res.data)\r\n\t\t/* 如果这次返回的数据量少于12，说明没有数据了，不要再次发送网络请求了 */\r\n\t\tif(res.data.length < queryParams.pageSize){\r\n\t\t\tisNodata.value = true\r\n\t\t}\r\n\t\tpageData.value = [...pageData.value,...res.data]\r\n\t\t\r\n\t\t// 每次都保存到缓存中\r\n\t\tuni.setStorageSync('classList',pageData.value)\r\n\t}\r\n\t\r\n\t\r\n\t// 触底加载更多,要做一次节流(n秒内,只运行一次，重复触发，只执行一次)，避免发送多次网络请求\r\n\t// 防抖(n秒后执行的事件，在n秒内再次触发，则重新计时)\r\n\tonReachBottom( async ()=>{\r\n\t\t// 没有数据时，触底直接返回\r\n\t\tif(isNodata.value) return \r\n\t\t\r\n\t\tisLoading.value = true\r\n\t\t\r\n\t\tqueryParams.pageNum++\r\n\t\tawait getPageData()\r\n\t\t\r\n\t\tisLoading.value = false\r\n\t\tconsole.log(isLoading.value)\r\n\t})\r\n\t\t\r\n\t\r\n\t// 下拉刷新\r\n\tonPullDownRefresh(async ()=>{\r\n\t\tqueryParams.pageNum = 1\r\n\t\tawait getPageData()\r\n\t\tuni.stopPullDownRefresh();\r\n\t})\r\n\t\n</script>\n\n<style lang=\"scss\" scoped>\r\n\t.classList{\r\n\t\t.content{\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-wrap: wrap;\r\n\t\t\t\t// gap:6rpx 6rpx; //行距 列距\r\n\t\t\t\tjustify-content: space-evenly;\r\n\t\t\t\t\r\n\t\t\t\t// 学一下grid布局\r\n\t\t\t.item{\r\n\t\t\t\twidth: 230rpx;\r\n\t\t\t\theight: 440rpx;\r\n\t\t\t\tmargin-bottom: 15rpx;\r\n\t\t\t\t&.end{\r\n\t\t\t\t\theight: 0;\r\n\t\t\t\t}\r\n\t\t\t\timage{\r\n\t\t\t\t\twidth: 100%;\r\n\t\t\t\t\theight: 100%; //不设置高度的问题，怎么解决\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\n</style>\n","import MiniProgramPage from 'C:/Users/admin/Desktop/xxj/Uniapp学习/wallpaper/pages/classList/classList.vue'\nwx.createPage(MiniProgramPage)"],"names":["onLoad","uni","ref","apiGetClassifyList","onReachBottom","onPullDownRefresh"],"mappings":";;;;;;;;;;;;;;;AA+BCA,kBAAM,OAAC,CAAC,MAAI;AACXC,oBAAAA,MAAY,MAAA,OAAA,uCAAA,QAAO,CAAC;AACpB,YAAM,EAAC,KAAG,MAAK,OAAK,GAAE,IAAI;AAC1B,UAAG,IAAG;AACL,oBAAY,UAAU;AAAA,MACtB;AACD,kBAAc;AAEdA,oBAAAA,MAAI,sBAAsB;AAAA,QACzB,OAAM;AAAA,MACT,CAAG;AAAA,IACH,CAAE;AAGD,QAAI,WAAWC,cAAG,IAAC,KAAK;AACxB,UAAM,YAAYA,cAAG,IAAC,KAAK;AAE3B,UAAM,cAAc;AAAA,MACnB,SAAQ;AAAA,MACR,SAAQ;AAAA,MACR,UAAS;AAAA,IACT;AAGD,UAAM,WAAWA,cAAG,IAAC,EAAE;AACtB,mBAAe,cAAa;AAE5B,YAAM,MAAM,MAAMC,SAAkB,mBAAC,WAAW;AAChDF,oBAAY,MAAA,MAAA,OAAA,uCAAA,OAAM,IAAI,IAAI;AAE1B,UAAG,IAAI,KAAK,SAAS,YAAY,UAAS;AACzC,iBAAS,QAAQ;AAAA,MACjB;AACD,eAAS,QAAQ,CAAC,GAAG,SAAS,OAAM,GAAG,IAAI,IAAI;AAG/CA,oBAAAA,MAAI,eAAe,aAAY,SAAS,KAAK;AAAA,IAC7C;AAKDG,kBAAAA,cAAe,YAAU;AAExB,UAAG,SAAS;AAAO;AAEnB,gBAAU,QAAQ;AAElB,kBAAY;AACZ,YAAM,YAAa;AAEnB,gBAAU,QAAQ;AAClBH,oBAAAA,MAAY,MAAA,OAAA,uCAAA,UAAU,KAAK;AAAA,IAC7B,CAAE;AAIDI,kBAAAA,kBAAkB,YAAU;AAC3B,kBAAY,UAAU;AACtB,YAAM,YAAa;AACnBJ,oBAAG,MAAC,oBAAmB;AAAA,IACzB,CAAE;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC3FF,GAAG,WAAW,eAAe;"}